<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="js/layui-mod/dtree/dtree.css">
    <link rel="stylesheet" href="js/layui-mod/dtree/font/iconfont.css">
    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="layui-row layui-col-space10">
            <div class="layui-fluid">
                <fieldset class="layui-elem-field layui-field-title" id="yjfxk">
                    <legend>示例</legend>
                    <div class="layui-field-box">
                        <div class="layui-row layui-col-space10" style="margin-top: 10px;">
                            <div class="layui-col-lg4">
                                <div>
                                    <ul id="commonTree3" class="dtree" data-id="0"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>

    <script src="layui/layui.js"></script>
    <script src="js/localhost.js"></script>
    <script src="js/api.js"></script>
    <script>
        layui.config({
            base: 'js/layui-mod/', //此处路径请自行处理, 可以使用绝对路径
        }).extend({
            dtree: 'dtree/dtree',
            formSelects: 'formSelects-v4'
        });
        layui.use(['element', 'layer', 'dtree'], function() {
            var element = layui.element,
                layer = layui.layer,
                dtree = layui.dtree,
                $ = layui.$;

            var data = [{
                "id": "001",
                "title": "湖南省",
                "isLast": false,
                "level": "1",
                "parentId": "0",
                "children": [{
                    "id": "001001",
                    "title": "长沙市",
                    "isLast": true,
                    "parentId": "001",
                    "level": "2"
                }]
            }]

            var treeData = [];

            function listIns() {
                var data = {
                    "utype": 1
                }; //1是仓库主类型
                $.ajax({
                    type: "get",
                    url: listInstitution,
                    data: data,
                    cache: false,
                    async: false,
                    success: function(res) {
                        console.log(res);
                        var insData = res.data;
                        for (var i = 0; i < insData.length; i++) {
                            //生成樹形一級菜單
                            if (insData[i].pid == 0) {
                                (function() {
                                    var item = {};
                                    item["id"] = insData[i].id;
                                    item["title"] = insData[i].name;
                                    item["isLast"] = false;
                                    item["parentId"] = 0;
                                    item["level"] = 1;
                                    treeData.push(item);
                                })();
                            }
                        }

                        for (var k = 0; k < treeData.length; k++) {
                            //循环生成二级菜单
                            for (var i = 0; i < insData.length; i++) {
                                if (treeData[k].id == insData[i].pid) {
                                    if (!Array.isArray(treeData[k]["children"])) {
                                        treeData[k]["children"] = [];
                                    };
                                    (function() {
                                        var item = {};
                                        item["id"] = insData[i].id;
                                        item["title"] = insData[i].name;
                                        item["isLast"] = true;
                                        item["parentId"] = treeData[k].id;
                                        item["level"] = 2;
                                        treeData[k]["children"].push(item);
                                    })()
                                }
                            }
                        }
                        console.log(treeData)
                    }
                })
            }
            listIns();

            dtree.render({
                elem: "#commonTree3",
                data: treeData,
                icon: "2",
                checkbar: true
            });

            dtree.on("node('commonTree3')", function(param){
                resTable(param)
            });

            // 点击菜单，根据菜单刷新表格
            function resTable(data) {
                // 刷新表格
                console.log(data)
                // $("#instid").val(data.nodeId); //隐藏域保存点击的菜单id
                // tableIns.reload({
                //     where: {
                //         "instid": data.nodeId
                //     },
                //     page: {
                //         curr: 1 //重新从第 1 页开始
                //     }
                // });
            }

        });
    </script>
</body>

</html>