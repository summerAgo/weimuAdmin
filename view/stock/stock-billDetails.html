<div class="table-page">
    <div class="table-content-title">
        <div class="table-tools">
            <ul class="layui-nav" lay-filter="talbe-tools">
                <li class="layui-nav-item">
                    <a href="javascript:;" id="toExport"><i class="iconfont icon-daochu"></i>导出数据</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;" id="ondayin"><i class="iconfont icon-dayin"></i>打印</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="table-page-header">
        <div class="table-page-form">
            <div class="lss-bread-crumb" id="details-title">

            </div>
        </div>
    </div>
    <div class="table-content">

        <div class="table-content-main">
            <table class="layui-hide" id="tableContainer_billDetails" lay-filter="tableContainer_billDetails"></table>
        </div>
    </div>
</div>
<script id="detailsTle" type="text/html">
    <div class="lss-bread-item">
        {{# if(d.type === "outHistory"){}}
        <p>出库订单号</p>
        {{#  } else{ }}
        <p>入库订单号</p>
        {{#  } }}
        <p>{{d.data.orderno}}</p>
    </div>
    <div class="lss-bread-item">
        <p>货权人</p>
        <p>{{d.data.ownername}}</p>
    </div>
    <div class="lss-bread-item">
        <p>仓库名称</p>
        <p>{{d.data.depname}}</p>
    </div>
    {{# if(d.data.outdate){}}
        <div class="lss-bread-item">
            <p>出库时间</p>
            <p>{{d.data.outdate}}</p>
        </div>
        <div class="lss-bread-item">
            <p>司机姓名</p>
            <p>{{d.vname||""}}</p>
        </div>
        <div class="lss-bread-item">
            <p>车牌号</p>
            <p>{{d.vehnum||""}}</p>
        </div>
        <div class="lss-bread-item">
            <p>司机身份号</p>
            <p>{{d.card||""}}</p>
        </div>
    {{#  } }}
</script>
<style scoped>
    .layui-elem-quote {
        margin-bottom: 0
    }

    .layer-title {
        display: flex;
        justify-content: space-around
    }

    .layer-title small {
        font-size: 14px;
    }

    .table-page h3 {
        padding-left: 0;
    }
</style>
<script>
    layui.use(['form', 'jquery', 'element', 'layer', 'table', 'formSelects', 'laytpl', 'laydate', 'upload'], function() {
        var element = layui.element;
        var form = layui.form;
        var $ = layui.jquery;
        var table = layui.table;
        var formSelects = layui.formSelects;
        var laytpl = layui.laytpl;

        var billDetails = JSON.parse(sessionStorage.getItem('billDetails')); //获取所选择记录详情
        //console.log(billDetails)
        if (!billDetails) {
            //判断是否存在，不存在跳转到首页
            history.replaceState(null, null, "#!home");
            $(".nav-tabs li").last().remove();
            return false;
        }
        // 渲染title的内容
        var getTpl = detailsTle.innerHTML,
            view = document.getElementById('details-title');
        laytpl(getTpl).render(billDetails, function(html) {
            view.innerHTML = html;
        });
        // 出库详情表格字段
        var outCols = [{
            field: "code",
            title: "包号",
            sort: true
        }, {
            field: "varieties",
            title: "品种",
            sort: true
        }, {
            field: "spec",
            title: "规格",
            sort: true
        }, {
            field: "levels",
            title: "等级",
            sort: true
        }, {
            field: "chang",
            title: "长度",
            sort: true,
            edit: "txt"
        }, {
            field: "brand",
            title: "品牌",
            sort: true
        }, {
            field: "origin",
            title: "产地",
            sort: true
        }, {
            field: "updauser",
            title: "操作员",
            sort: true
        }, {
            field: "billloading",
            title: "提运单",
            sort: true
        }, {
            field: "containernum",
            title: "货柜号/批次号",
            sort: true
        }];
        // 入库详情表格字段
        var entryCols = [{
            field: "code",
            title: "包号",
            sort: true
        }, {
            field: "varieties",
            title: "品种",
            sort: true
        }, {
            field: "spec",
            title: "规格",
            sort: true
        }, {
            field: "levels",
            title: "等级",
            sort: true
        }, {
            field: "chang",
            title: "长度",
            sort: true,
            edit: "txt"
        }, {
            field: "brand",
            title: "品牌",
            sort: true
        }, {
            field: "origin",
            title: "产地",
            sort: true
        }, {
            field: "num",
            title: "数量（m³）",
            sort: true
        }, {
            field: "positionid",
            title: "库位",
            sort: true
        }, {
            field: "updauser",
            title: "操作员",
            sort: true
        }, {
            field: "billloading",
            title: "提运单",
            sort: true
        }, {
            field: "containernum",
            title: "货柜号/批次号",
            sort: true
        }];

        var tableClos; //表格字段赋值
        if (billDetails.type == "outHistory") {
            tableClos = outCols;
        } else {
            tableClos = entryCols;
        }

        var tableTopHeight = (parseInt($(".table-page-header").innerHeight()) + parseInt($(".table-content-title").innerHeight()) + parseInt($(".content-header").innerHeight()) + 103); //内容区域所需减去的高度

        var tableIns = table.render({
            elem: '#tableContainer_billDetails',
            height: 'full-' + tableTopHeight,
            data: billDetails.stocklist,
            cols: [
                tableClos
            ],
            even: true,
            page: true, //是否显示分页
            limits: [15, 20, 30, 40, 50],
            limit: 15, //每页默认显示的数量
            done: function(res, curr, count) {
                var addtableBtn = '<div class="rightBotBtn">合计： 件数<span>' + billDetails.znum + '</span>包 数量：<span>' + billDetails.cube + '</span>m³</div>';
                $(".layui-table-page").append(addtableBtn);
            },
            text: {
                none: "无匹配数据"
            },
            loading: true
        });

        //点击导出
        $("#toExport").on('click', function(e) {
            window.location.href = ilbstockExportUrl
        });

        //打印
        $("#ondayin").on('click', function(e) {
            var orderno = billDetails.data.orderno
            var url;
            if (billDetails.type == "outHistory") {
                url = printoutstore;
            } else {
                url = printinstore;
            }
            sessionStorage.setItem('dayin_orderno', orderno);
            window.open(url, '打印', 'height=800, width=1100, top=100, left=100, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no');
        });

    });
</script>