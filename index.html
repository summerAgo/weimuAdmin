<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">

    <title>维木智能仓储系统</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="js/layui-mod/formSelects-v4.css">
    <link rel="stylesheet" href="js/layui-mod/eleTree.css" media="all">
    <link rel="stylesheet" href="style/iconfont/iconfont.css">
    <link rel="stylesheet" href="style/index.css">
    <link rel="stylesheet" href="style/home.css">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header index-header clearfix">
            <div class="layui-logo">
                <div class="logo"></div>
            </div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <!-- <ul class="layui-nav layui-layout-left">
                <li>
                    <div class="header-seacherBox">
                        <input type="text" placeholder="请输入关键词搜索，如货物ID、品种...">
                        <span class="seacherBtn"><i class="iconfont icon-sousuo"></i></span>
                    </div>
                </li>
            </ul> -->
            <div class="header-version"></div>
            <ul class="layui-nav layui-layout-right">
                <!-- <li class="layui-nav-item">
                    <a href="javascript:;" class="msgtips"><i class="iconfont icon-lingdang"></i><span class="msgcount">9</span></a>
                </li> -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                        <span class="rolename">超级管理员</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;" class="signOutBtn">退出登录</a></dd>
                    </dl>
                </li>
            </ul>
        </div>

        <div class="layui-side index-side">
            <div class="layui-side-scroll" id="menuview">
                <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            </div>
        </div>

        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div class="content-header">
                <div class="layui-tab nav-tabs" lay-filter="nav-tabs" lay-allowClose="true">
                    <ul class="layui-tab-title">
                        <li lay-id="home" class="nav-tabs-home"><span class="iconfont icon-zhuye"></span></li>
                    </ul>
                </div>
                <!-- <div class="refresh"><i class="layui-icon layui-icon-refresh"></i> 刷新</div> -->
            </div>
            <div class="content-body"></div>
        </div>
    </div>

    <script id="menuTlp" type="text/html">
        <ul class="layui-nav layui-nav-tree" lay-filter="index-side" lay-shrink="all">
            {{# layui.each(d.list, function(index, item){ }}
                {{# if(item.pid == 0){ }}
                    <li class="layui-nav-item">
                        {{#  if(item.code){ }}
                            <a href="#!{{item.code}}"><i class="iconfont {{ item.icon}}"></i>{{item.name}}</a>
                        {{#  } else { }}
                            <a href="javascript:;"><i class="iconfont {{ item.icon}}"></i>{{item.name}}</a>
                        {{#  } }}
                        {{# if(item.child){}}
                            <dl class="layui-nav-child">
                                {{# layui.each(d.list, function(indexx, itemx){ }}
                                    {{# if(itemx.pid == item.id){}}
                                        <dd><a href="#!{{ itemx.code }}">{{ itemx.name }}</a></dd>
                                    {{# }}}
                                {{# }); }}
                            </dl>
                        {{# } }}
                    </li>
                {{# } }}
            {{# }); }}
        </ul>
    </script>

    <script src="layui/layui.js"></script>
    <script src="js/localhost.js"></script>
    <script src="js/q.js"></script>
    <script src="js/api.js"></script>
    <script src="js/common.js"></script>
    <script>
        var roleName = sessionStorage.getItem("rolename");

        if (!roleName) {
            //判断是否已登录
            window.location.href = localhost + "/view/login/login.html";
        }

        layui.config({
            base: 'js/layui-mod/' //此处路径请自行处理, 可以使用绝对路径
        }).extend({
            formSelects: 'formSelects-v4'
        });

        layui.use(['jquery', 'element', 'layer', 'laytpl'], function() {
            var element = layui.element,
                $ = layui.$,
                laytpl = layui.laytpl;
            var container = $('.content-body'); //页面容器
            // var userInfo = JSON.parse(getCookie('userInfo')); //获取session中用户信息
            $(".rolename").html(roleName);

            //该用户菜单权限JSON
            var menujson = JSON.parse(sessionStorage.getItem("menuAuthority"));
            // console.log(menujson);
            var menuArr = []; //菜单显示
            var menuRoute = []; //路由
            for (var key in menujson) {
                var json = JSON.parse(menujson[key]);
                if (json) {
                    var v = [json.code, function() {
                        container.load(json.url);
                    }]
                    // menuRoute.push(v);
                }
                menuArr.push(json);
            }
            // console.log(menuArr);
            for (var i = 0; i < menuArr.length; i++) {
                for (var x = 0; x < menuArr.length; x++) {
                    if (menuArr[x].pid === menuArr[i].id) {
                        menuArr[i].child = true;
                    }
                }
            }
            // 左侧菜单模板渲染
            var getTpl = menuTlp.innerHTML,
                view = document.getElementById('menuview');
            var data = { //数据
                "list": menuArr
            };
            // console.log(data);
            laytpl(getTpl).render(data, function(html) {
                view.innerHTML = html;
            });


            element.render("nav-tabs");//加载路由
            Q.reg([
                //注册页面
                ['home', function() {
                    container.load('/view/home/home.html');
                }],
                ['stock-preentry', function() {
                    container.load('/view/stock/stock-preentry.html');
                }],
                ['stock-outHistory', function() {
                    container.load('/view/stock/stock-outHistory.html');
                }],
                ['stock-enterHistory', function() {
                    container.load('/view/stock/stock-enterHistory.html');
                }],
                //////////////////////////
                ['stock-enterBillDetails', function() {
                    container.load('/view/stock/stock-enterBillDetails.html');
                }],
                ['stock-outBillDetails', function() {
                    container.load('/view/stock/stock-outBillDetails.html');
                }],
                ['stock-outBill', function() {
                    container.load('/view/stock/stock-outBill.html');
                }],
                //////////////////////////
                ['stock-addOutBill', function() {
                    container.load('/view/stock/stock-addOutBill.html');
                }],
                ['ilbstock-info', function() {
                    container.load('/view/ilbstock/ilbstock-info.html');
                }],
                ['ilbstock-abnormal', function() {
                    container.load('/view/ilbstock/ilbstock-abnormal.html');
                }],
                ['ilbstock-inventory', function() {
                    container.load('/view/ilbstock/ilbstock-inventory.html');
                }],
                ['user-list', function() {
                    container.load('/view/user/user-list.html');
                }],
                ['role-list', function() {
                    container.load('/view/role/role-list.html');
                }],
                ['role-power', function() {
                    container.load('/view/role/role-power.html');
                }],
                ['menu-list', function() {
                    container.load('/view/menu/menu-list.html');
                }],
                ['button-list', function() {
                    container.load('/view/button/button-list.html');
                }],
                ['depot-list', function() {
                    container.load('/view/depot/depot-list.html');
                }],
                ///////////////////
                ['depot-position', function() {
                    container.load('/view/depot/depot-position.html');
                }],
                ['base-infodata', function() {
                    container.load('/view/base/base-infodata.html');
                }],
                ['owner-list', function() {
                    container.load('/view/base/owner-list.html');
                }],
                ['supplier-list', function() {
                    container.load('/view/base/supplier-list.html');
                }],
                ['risk-goodsAssess', function() {
                    container.load('/view/risk/risk-goodsAssess.html');
                }],
                ['risk-shipWarn', function() {
                    container.load('/view/risk/risk-shipWarn.html');
                }],
                ['risk-shipExamine', function() {
                    container.load('/view/risk/risk-shipExamine.html');
                }],
                ['risk-examineRecode', function() {
                    container.load('/view/risk/risk-examineRecode.html');
                }]
            ]);

            Q.init({
                index: 'home',
                pop: function(vid) {
                    // hash改变执行
                    var thehash = $(".index-side a").attr("href").replace(/#!/, '');
                    var dom;
                    if (dom = $('.layui-nav dd.layui-this')) {
                        dom.removeClass("layui-this");
                        dom.parents("li.layui-nav-item").removeClass("layui-nav-itemed");
                    }
                    if (dom = $('.layui-nav a[href="#!' + vid + '"]')) {
                        dom.parent("dd").addClass("layui-this");
                        dom.parents("li.layui-nav-item").addClass("layui-nav-itemed");

                        if ($(".layui-tab-title li[lay-id]").length <= 0) {
                            element.tabAdd('nav-tabs', {
                                title: dom.html() || "单号详情",
                                id: vid
                            });
                        } else {
                            var isData = false;
                            $.each($(".layui-tab-title li[lay-id]"), function() {
                                if ($(this).attr("lay-id") === vid) {
                                    isData = true;
                                }
                            });
                            if (isData === false) {
                                var title;
                                if (vid === "stock-addOutBill") {
                                    title = "出货申请单详情";
                                } else if (vid === "stock-enterBillDetails") {
                                    title = "入库单详情";
                                } else if (vid === "stock-outBillDetails") {
                                    title = "出库单详情";
                                } else if (vid === "depot-position") {
                                    title = "库位详情";
                                }
                                element.tabAdd('nav-tabs', {
                                    title: dom.html() || title,
                                    id: vid
                                });
                            }
                        }
                        element.tabChange('nav-tabs', vid);
                    }
                }
            });

            //获取hash来切换选项卡，假设当前地址的hash为lay-id对应的值
            // var layid = location.hash.replace(/#!/, '');
            // element.tabChange('nav-tabs', layid);

            //监听Tab切换，以改变地址hash值
            element.on('tab(nav-tabs)', function() {
                location.hash = '#!' + this.getAttribute('lay-id');
            });

            /*$(".header-seacherBox input").focus(function() {
                //头部搜索框获取焦点变亮
                $(".header-seacherBox").addClass('opacity1');
            }).blur(function() {
                if ($(this).val() === "") {
                    $(".header-seacherBox").removeClass('opacity1');
                }
            });*/

            $(".signOutBtn").click(signOut); //退出登录
            function signOut() {
                //退出登录
                delCookie("SESSION_NAME");
                delCookie("rolename");
                delCookie("menuAuthority");
                delCookie("buttonAuthority");
                history.replaceState({}, 'login', localhost + "/view/login/login.html");
                window.location.href = localhost + "/view/login/login.html";
            }

            var menuBtnData = {
        "a_18": [{"bname":"添加","id":45,"menuid":18,"offset":0,"type":0,"class":"toAdd"}, {"bname":"编辑","id":46,"menuid":18,"offset":0,"type":0,"class":"updateBtn"}, {"bname":"删除","id":47,"menuid":18,"offset":0,"type":0,"class":"deleteBtn"}],
        "a_17": [{"bname":"删除","id":35,"menuid":17,"offset":0,"type":0},{"bname":"添加菜单","id":33,"menuid":17,"offset":0,"type":0},{"bname":"编辑","id":34,"menuid":17,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":36,"menuid":17,"offset":0,"type":0}],
        "a_19": [{"bname":"添加仓库主","id":37,"menuid":19,"offset":0,"type":0},{"bname":"编辑","id":38,"menuid":19,"offset":0,"type":0},{"bname":"删除","id":39,"menuid":19,"offset":0,"type":0}],
        "a_14": [{"bname":"刷新","id":21,"menuid":14,"offset":0,"type":0},{"bname":"重置","icon":"layui-btn layui-btn-md layui-btn-gray","id":22,"menuid":14,"offset":0,"type":0}],
        "a_25": [{"bname":"刷新","id":59,"menuid":25,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":60,"menuid":25,"offset":0,"type":0}],
        "a_13": [{"bname":"刷新","id":18,"menuid":13,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":19,"menuid":13,"offset":0,"type":0},{"bname":"重置","icon":"layui-btn layui-btn-md layui-btn-gray","id":20,"menuid":13,"offset":0,"type":0}],
        "a_24": [{"bname":"刷新","id":57,"menuid":24,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":58,"menuid":24,"offset":0,"type":0}],
        "a_16": [{"bname":"添加角色","id":28,"menuid":16,"offset":0,"type":0},{"bname":"编辑","id":30,"menuid":16,"offset":0,"type":0},{"bname":"删除","id":31,"menuid":16,"offset":0,"type":0},{"bname":"权限设置","id":29,"menuid":16,"offset":0,"type":0}],
        "a_15": [{"bname":"添加用户","id":23,"menuid":15,"offset":0,"type":0},{"bname":"重置密码","id":24,"menuid":15,"offset":0,"type":0},{"bname":"设置角色","id":25,"menuid":15,"offset":0,"type":0},{"bname":"编辑","id":26,"menuid":15,"offset":0,"type":0},{"bname":"删除","id":27,"menuid":15,"offset":0,"type":0}],
        "a_10": [{"bname":"新建盘点","icon":"iconfont icon-tianjia","id":5,"menuid":10,"offset":0,"type":0},{"bname":"删除已盘点","id":6,"menuid":10,"offset":0,"type":0},{"bname":"删除","id":7,"menuid":10,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":8,"menuid":10,"offset":0,"type":0},{"bname":"重置","icon":"layui-btn layui-btn-md layui-btn-gray","id":9,"menuid":10,"offset":0,"type":0}],
        "a_21": [{"bname":"添加供应商","id":41,"menuid":21,"offset":0,"type":0},{"bname":"编辑","id":42,"menuid":21,"offset":0,"type":0},{"bname":"删除","id":43,"menuid":21,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":44,"menuid":21,"offset":0,"type":0}],
        "x_11": [{"bname":"下载模板","id":64,"menuid":11,"offset":0,"type":1},{"bname":"导入数据","icon":"iconfont icon-daoru","id":65,"menuid":11,"offset":0,"type":1},{"bname":"添加货物信息","icon":"iconfont icon-tianjiahuowu","id":66,"menuid":11,"offset":0,"type":1},{"bname":"保存","icon":"iconfont icon-baocun","id":67,"menuid":11,"offset":0,"type":1},{"bname":"取消","icon":"iconfont icon-quxiao","id":68,"menuid":11,"offset":0,"type":1},{"bname":"删除","icon":"iconfont icon-shanchu","id":69,"menuid":11,"offset":0,"type":1}],
        "b_11": [{"bname":"下载模板","id":64,"menuid":11,"offset":0,"type":1},{"bname":"导入数据","icon":"iconfont icon-daoru","id":65,"menuid":11,"offset":0,"type":1},{"bname":"添加货物信息","icon":"iconfont icon-tianjiahuowu","id":66,"menuid":11,"offset":0,"type":1},{"bname":"保存","icon":"iconfont icon-baocun","id":67,"menuid":11,"offset":0,"type":1},{"bname":"取消","icon":"iconfont icon-quxiao","id":68,"menuid":11,"offset":0,"type":1},{"bname":"删除","icon":"iconfont icon-shanchu","id":69,"menuid":11,"offset":0,"type":1}],
        "a_20": [{"bname":"新增仓库","id":49,"menuid":20,"offset":0,"type":0},{"bname":"编辑","id":50,"menuid":20,"offset":0,"type":0},{"bname":"删除","id":51,"menuid":20,"offset":0,"type":0}],
        "x_10": [{"bname":"保存","icon":"iconfont icon-baocunxinzeng","id":63,"menuid":10,"offset":0,"type":1},{"bname":"从库存添加货物","icon":"iconfont icon-tianjiahuowu","id":61,"menuid":10,"offset":0,"type":1},{"bname":"移除","icon":"iconfont icon-shanchu","id":62,"menuid":10,"offset":0,"type":1}],
        "b_10": [{"bname":"保存","icon":"iconfont icon-baocunxinzeng","id":63,"menuid":10,"offset":0,"type":1},{"bname":"从库存添加货物","icon":"iconfont icon-tianjiahuowu","id":61,"menuid":10,"offset":0,"type":1},{"bname":"移除","icon":"iconfont icon-shanchu","id":62,"menuid":10,"offset":0,"type":1}],
        "a_12": [{"bname":"入库","id":14,"menuid":12,"offset":0,"type":0},{"bname":"删除","id":15,"menuid":12,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":16,"menuid":12,"offset":0,"type":0}],
        "a_23": [{"bname":"刷新","id":55,"menuid":23,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":56,"menuid":23,"offset":0,"type":0}],
        "a_11": [{"bname":"删除","id":11,"menuid":11,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":12,"menuid":11,"offset":0,"type":0}],
        "a_22": [{"bname":"刷新","id":53,"menuid":22,"offset":0,"type":0},{"bname":"查询","icon":"iconfont icon-sousuo","id":54,"menuid":22,"offset":0,"type":0}],
        "a_8": [{"bname":"导出","code":"gwqw","icon":"iconfont icon-daochu","id":1,"level":0,"menuid":8,"offset":0,"sort":0,"type":0},{"bname":"刷新","code":"gwq","id":2,"level":0,"menuid":8,"offset":0,"type":0},{"bname":"查询","code":"fgqq","icon":"iconfont icon-sousuo","id":3,"menuid":8,"offset":0,"type":0},{"bname":"重置","code":"geww","icon":"layui-btn layui-btn-md layui-btn-gray","id":4,"menuid":8,"offset":0,"type":0}]
    };

            sessionStorage.setItem("menuBtnData", JSON.stringify(menuBtnData));
        });
    </script>

</body>

</html>